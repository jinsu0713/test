<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIN ê²€ìƒ‰ ê°¤ëŸ¬ë¦¬ ë° ìš´ì†¡ ì¡°íšŒ</title>
    <style>
        /* ê¸°ë³¸ì ì¸ UI ìŠ¤íƒ€ì¼ */
        body { 
            font-family: Arial, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-top: 50px; 
            background-color: #f8f9fa;
        }
        h1 { color: #343a40; }
        .search-box { 
            background-color: #ffffff; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
            text-align: center;
            margin-top: 20px;
        }
        h2 { margin-top: 0; color: #495057; }
        input[type="text"] { 
            padding: 12px; 
            border: 1px solid #ced4da; 
            border-radius: 6px; 
            width: 300px; 
            margin-right: 10px; 
            font-size: 16px;
        }
        button { 
            padding: 12px 25px; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover { 
            background-color: #0056b3; 
        }
        #result-area { 
            margin-top: 40px; 
            font-size: 1.1em; 
            text-align: center;
            width: 90%;
            max-width: 800px;
        }
        .error { 
            color: #dc3545; 
            font-weight: bold;
        }
        .success-message { 
            color: #28a745; 
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .tracking-table {
            width: 100%;
            margin-top: 30px;
            border-collapse: collapse;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            text-align: left;
        }
        .tracking-table th, .tracking-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        .tracking-table th {
            background-color: #f1f1f1;
            width: 30%;
            font-weight: bold;
            color: #495057;
        }
        .tracking-table td {
            background-color: #ffffff;
            color: #343a40;
        }
        .tracking-header {
            color: #007bff;
            margin-top: 40px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <h1>My Car Photo at Incheon port, Korea ğŸš¢ğŸš—ğŸ‡°ğŸ‡·</h1>
    <p>Enter the last 8 or full 17 digits of the VIN.</p>

    <div class="search-box">
        <h2>What is the VIN of your car?</h2>
        <input type="text" id="vinInput" placeholder="Last 8 or Full 17 VIN digits" maxlength="17">
        <button onclick="searchVin()">Search</button>
    </div>

    <div id="result-area"></div>

    <!-- Firebase SDK ë¡œë“œ -->
    <script type="module">
        // ëª¨ë“ˆ ë°©ì‹ import
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc, collection } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        // â­ ìƒˆ í”„ë¡œì íŠ¸ (test-a6250) ì„¤ì • ì •ë³´ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤. â­
        const firebaseConfig = {
            apiKey: "AIzaSyDi1uTH1anhIZDqA2kV8EYJ_YxagO0vQ6Y",
            authDomain: "test-a6250.firebaseapp.com",
            projectId: "test-a6250", 
            storageBucket: "test-a6250.firebasestorage.app",
            messagingSenderId: "237086338046",
            appId: "1:237086338046:web:be2cbb2a536742806f6eaf",
            measurementId: "G-5CRQHGH89B"
        };

        // Firebase ì´ˆê¸°í™” ë¡œì§
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase initialized successfully with new project (Module).");

        } catch (e) {
            console.error("Firebase Initialization Error:", e);
            document.getElementById('result-area').innerHTML = 
                '<p class="error">âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨! (API í‚¤, í”„ë¡œì íŠ¸ ID ë˜ëŠ” SDK ë¬¸ì œ)</p>';
            
        }
        
        // VIN ë°ì´í„°ê°€ ì €ì¥ë  ì»¬ë ‰ì…˜ ì´ë¦„ ('cars')ì„ ì°¸ì¡°í•©ë‹ˆë‹¤. 
        const carsRef = db ? collection(db, "cars") : null; 

        /**
         * VINì„ ê²€ìƒ‰í•˜ê³  Firestoreì—ì„œ ì•¨ë²” URLì„ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
         */
        window.searchVin = async function() {
            const vin = document.getElementById('vinInput').value.trim();
            const resultArea = document.getElementById('result-area');
            
            if (!db) {
                resultArea.innerHTML = '<p class="error">Firebase ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½˜ì†” ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
                return;
            }

            resultArea.innerHTML = '<p style="color: #007bff;">ğŸ” Searching...</p>';

            if (!vin) {
                resultArea.innerHTML = '<p class="error">VIN ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>';
                return;
            }

            try {
                const docRef = doc(db, "cars", vin); 
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const url = data.albumUrl; 
                    
                    // Firestoreì—ì„œ ì¡°íšŒí•  ì¶”ê°€ í•„ë“œ (ê³ ê°ë‹˜ì˜ ìš”ì²­ì— ë”°ë¼ ì„ì˜ë¡œ ì§€ì •)
                    const model = data.model || 'N/A';
                    const vessel = data.vessel || 'N/A';
                    const eta = data.eta || 'N/A';
                    const pol = data.pol || 'N/A';
                    const port = data.port || 'N/A';
                    const shipper = data.shipper || 'N/A';
                    const trackingLink = data.trackingLink || 'https://cigshipping.com/Home/cargo.html';

                    // HTML ê²°ê³¼ ìƒì„±
                    let resultHtml = `
                        <p class="success-message">âœ… VIN **${vin}** ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!</p>
                        
                        <!-- Google í¬í†  ì•¨ë²” ë§í¬ -->
                        ${url ? 
                            `<p style="margin-bottom: 20px;">
                                <a href="${url}" target="_blank" style="color: #17a2b8; font-weight: bold; text-decoration: none;">â¡ï¸ Google í¬í†  ì•¨ë²” ë°”ë¡œê°€ê¸°</a>
                            </p>` 
                            : ''}

                        <!-- CARGO TRACKING í—¤ë” -->
                        <h2 class="tracking-header">CARGO TRACKING</h2>
                        
                        <!-- ìš´ì†¡ ìƒì„¸ ì •ë³´ í…Œì´ë¸” -->
                        <table class="tracking-table">
                            <thead>
                                <tr><th colspan="2" style="background-color: #007bff; color: white;">CARGO STATUS</th></tr>
                            </thead>
                            <tbody>
                                <tr><th>SHIPPER</th><td>${shipper}</td><th>MODEL(YEAR)</th><td>${model}</td></tr>
                                <tr><th>CHASSIS</th><td>${vin}</td><th>VESSEL</th><td>${vessel}</td></tr>
                                <tr><th>POL</th><td>${pol}</td><th>On Board</th><td>${data.onBoard || 'N/A'}</td></tr>
                                <tr><th>PORT</th><td>${port}</td><th>ETA</th><td>${eta}</td></tr>
                            </tbody>
                        </table>

                        <!-- ì™¸ë¶€ ì‚¬ì´íŠ¸ íŠ¸ë˜í‚¹ ë§í¬ (ì§ì ‘ ì¡°íšŒê°€ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ ë§í¬ ì œê³µ) -->
                        <p style="margin-top: 20px;">
                            <a href="${trackingLink}" target="_blank" style="color: #28a745; font-weight: bold; text-decoration: none;">
                                ğŸš¢ ìš´ì†¡ì‚¬ ì‚¬ì´íŠ¸ì—ì„œ ìƒì„¸ íŠ¸ë˜í‚¹ ì •ë³´ í™•ì¸í•˜ê¸°
                            </a>
                        </p>
                    `;
                    
                    resultArea.innerHTML = resultHtml;
                   
                } else {
                    resultArea.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: VIN **${vin}** ì— í•´ë‹¹í•˜ëŠ” ì°¨ëŸ‰ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }
            } catch (error) {
                console.error("Firestore Read Error (Check Rules/Data):", error); 
                resultArea.innerHTML = `<p class="error">ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (Consoleì„ í™•ì¸í•˜ì„¸ìš”)</p>`;
            }
        }
    </script>
</body>
</html>