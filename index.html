<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIN ê²€ìƒ‰ ê°¤ëŸ¬ë¦¬ ë° ìš´ì†¡ ì¡°íšŒ (Netlify Function)</title>
    <style>
        /* ê¸°ë³¸ì ì¸ UI ìŠ¤íƒ€ì¼ */
        body { 
            font-family: Arial, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-top: 50px; 
            background-color: #f8f9fa;
        }
        h1 { color: #343a40; }
        .search-box { 
            background-color: #ffffff; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
            text-align: center;
            margin-top: 20px;
        }
        h2 { margin-top: 0; color: #495057; }
        input[type="text"] { 
            padding: 12px; 
            border: 1px solid #ced4da; 
            border-radius: 6px; 
            width: 300px; 
            margin-right: 10px; 
            font-size: 16px;
        }
        button { 
            padding: 12px 25px; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover { 
            background-color: #0056b3; 
        }
        #result-area { 
            margin-top: 40px; 
            font-size: 1.1em; 
            text-align: center;
            width: 90%;
            max-width: 1000px; 
        }
        .error { 
            color: #dc3545; 
            font-weight: bold;
        }
        .success-message { 
            color: #28a745; 
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .tracking-table {
            width: 100%;
            margin-top: 30px;
            border-collapse: collapse;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            text-align: left;
        }
        .tracking-table th, .tracking-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            white-space: normal;
        }
        .tracking-table th {
            background-color: #f1f1f1;
            width: 20%; 
            font-weight: bold;
            color: #495057;
        }
        .tracking-table td {
            background-color: #ffffff;
            color: #343a40;
        }
        .tracking-header {
            color: #007bff;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        /* ëª¨ë°”ì¼ í™˜ê²½ ìµœì í™” */
        @media (max-width: 768px) {
            .tracking-table th {
                width: 30%; 
                padding: 8px 10px;
            }
            .tracking-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>

    <h1>My Car Photo at Incheon port, Korea ğŸš¢ğŸš—ğŸ‡°ğŸ‡·</h1>
    <p>Enter the last 8 or full 17 digits of the VIN.</p>

    <div class="search-box">
        <h2>What is the VIN of your car?</h2>
        <input type="text" id="vinInput" placeholder="Last 8 or Full 17 VIN digits" maxlength="17">
        <button onclick="searchVin()">Search</button>
    </div>

    <div id="result-area"></div>

    <script type="module">

        /**
         * VINì„ ê²€ìƒ‰í•˜ê³  Netlify Functionì„ í˜¸ì¶œí•˜ì—¬ ì•¨ë²” URL ë° ìš´ì†¡ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
         */
        window.searchVin = async function() {
            const vin = document.getElementById('vinInput').value.trim();
            const resultArea = document.getElementById('result-area');
            
            // Netlify Functionì˜ ì—”ë“œí¬ì¸íŠ¸ URL
            const FUNCTION_ENDPOINT = '/.netlify/functions/vin_search';

            resultArea.innerHTML = '<p style="color: #007bff;">ğŸ” Searching using Netlify Function...</p>';

            if (!vin) {
                resultArea.innerHTML = '<p class="error">VIN ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>';
                return;
            }
            
            // VINì„ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ í¬í•¨í•˜ì—¬ Netlify Functionì— ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
            const url = `${FUNCTION_ENDPOINT}?vin=${encodeURIComponent(vin)}`;

            try {
                const response = await fetch(url);
                const data = await response.json(); // Python Functionì´ ë°˜í™˜í•œ JSON ë°ì´í„°

                if (response.ok && data.found) {
                    
                    // Python Functionì´ ë°˜í™˜í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    const url = data.albumUrl || ''; 
                    const model = data.model || 'N/A';
                    const vessel = data.vessel || 'N/A';
                    const eta = data.eta || 'N/A';
                    const port = data.port || 'N/A';
                    
                    // í˜„ì¬ Python Functionì— ì—†ëŠ” ë°ì´í„°ëŠ” ì„ì‹œ ê°’ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
                    const shipper = data.shipper || 'N/A';
                    const onBoard = data.onBoard || 'N/A';
                    const trackingLink = data.trackingLink || 'https://cigshipping.com/Home/cargo.html';


                    // HTML ê²°ê³¼ ìƒì„±
                    let resultHtml = `
                        <p class="success-message">âœ… VIN **${vin}** ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤! (Netlify Function)</p>
                        
                        ${url ? 
                            `<p style="margin-bottom: 20px;">
                                <a href="${url}" target="_blank" style="color: #17a2b8; font-weight: bold; text-decoration: none;">â¡ï¸ Google í¬í†  ì•¨ë²” ë°”ë¡œê°€ê¸°</a>
                            </p>` 
                            : ''}

                        <h2 class="tracking-header">CARGO TRACKING</h2>
                        
                        <table class="tracking-table">
                            <thead>
                                <tr><th colspan="2" style="background-color: #007bff; color: white;">CARGO STATUS</th></tr>
                            </thead>
                            <tbody>
                                <tr><th>SHIPPER</th><td>${shipper}</td><th>MODEL(YEAR)</th><td>${model}</td></tr>
                                <tr><th>CHASSIS</th><td>${vin}</td><th>VESSEL</th><td>${vessel}</td></tr>
                                <tr><th>POL</th><td>Python Data</td><th>On Board</th><td>${onBoard}</td></tr>
                                <tr><th>PORT</th><td>${port}</td><th>ETA</th><td>${eta}</td></tr>
                            </tbody>
                        </table>

                        <p style="margin-top: 20px;">
                            <a href="${trackingLink}" target="_blank" style="color: #28a745; font-weight: bold; text-decoration: none;">
                                ğŸš¢ ìš´ì†¡ì‚¬ ì‚¬ì´íŠ¸ì—ì„œ ìƒì„¸ íŠ¸ë˜í‚¹ ì •ë³´ í™•ì¸í•˜ê¸°
                            </a>
                        </p>
                    `;
                    
                    resultArea.innerHTML = resultHtml;
                   
                } else {
                    // Functionì—ì„œ 404ë¥¼ ë°˜í™˜í•˜ê±°ë‚˜ data.foundê°€ falseì¼ ê²½ìš°
                    const errorMessage = data.message || `ì˜¤ë¥˜: ${response.status} (${response.statusText})`;
                    resultArea.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: VIN **${vin}** ì— í•´ë‹¹í•˜ëŠ” ì°¨ëŸ‰ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (${errorMessage})</p>`;
                }
            } catch (error) {
                console.error("Netlify Function í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error); 
                resultArea.innerHTML = `<p class="error">í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (Consoleì„ í™•ì¸í•˜ì„¸ìš”)</p>`;
            }
        }
    </script>
</body>
</html>